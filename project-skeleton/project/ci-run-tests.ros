#!/bin/sh
#|-*- mode:lisp -*-|#
#|
exec ros -Q -- $0 "$@"
|#

(ql:quickload :fiveam)<% @if with-coveralls %>
(ql:quickload :cl-coveralls)<% @endif %>
(ql:quickload :<% @var name %>)
(ql:quickload :<% @var name %>-test)

(defun main (&rest argv)
  (declare (ignorable argv))
  (uiop:quit (if (handler-case
                     (progn
                       (let ((5am:*debug-on-error* t)
                             (5am:*debug-on-failure* t))
                         <% @if with-coveralls %>
                         (coveralls:with-coveralls (:exclude (list "t"))
                           (asdf:test-system :<% @var name %>))
                         <% @else %>
                         (asdf:test-system :<% @var name %>)
                         <% @endif %>))
                   (serious-condition (c)
                     (describe c)
                     (uiop:quit 2)))
                 0
                 1)))
